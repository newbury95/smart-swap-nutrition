import{c as be,j as i,C as Z,R as u,r as B,a as we,u as ee,x as te,N as re,B as je,y as $}from"./index-C8xUIhnV.js";import{P as c}from"./index-DaCuhH6Q.js";import{A as Pe,a as ke}from"./alert-Q5kzU01V.js";import{m as Oe}from"./proxy-Dun-j3uU.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=be("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Ne=()=>i.jsx("div",{className:"min-h-screen flex items-center justify-center",children:i.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-green-600"})}),Re=()=>{const r=["Personalized meal plans","Advanced nutrition tracking","Premium workout plans","Custom foods and recipes","Health app integration (Apple Health & Samsung Health)"];return i.jsxs("div",{className:"mb-8",children:[i.jsx("h2",{className:"text-xl font-medium mb-4",children:"Benefits include:"}),i.jsx("ul",{className:"space-y-3",children:r.map((e,t)=>i.jsxs("li",{className:"flex items-center gap-2",children:[i.jsx(Z,{className:"w-4 h-4 text-yellow-500"}),i.jsx("span",{children:e})]},t))})]})};var ne="https://js.stripe.com/v3",Le=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,K="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",Ue=function(){for(var e=document.querySelectorAll('script[src^="'.concat(ne,'"]')),t=0;t<e.length;t++){var n=e[t];if(Le.test(n.src))return n}return null},J=function(e){var t="",n=document.createElement("script");n.src="".concat(ne).concat(t);var o=document.head||document.body;if(!o)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return o.appendChild(n),n},_e=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"2.4.0",startTime:t})},k=null,U=null,_=null,Te=function(e){return function(){e(new Error("Failed to load Stripe.js"))}},Be=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},Ie=function(e){return k!==null?k:(k=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(K),window.Stripe){t(window.Stripe);return}try{var o=Ue();if(o&&e)console.warn(K);else if(!o)o=J(e);else if(o&&_!==null&&U!==null){var a;o.removeEventListener("load",_),o.removeEventListener("error",U),(a=o.parentNode)===null||a===void 0||a.removeChild(o),o=J(e)}_=Be(t,n),U=Te(n),o.addEventListener("load",_),o.addEventListener("error",U)}catch(l){n(l);return}}),k.catch(function(t){return k=null,Promise.reject(t)}))},We=function(e,t,n){if(e===null)return null;var o=e.apply(void 0,t);return _e(o,n),o},O,oe=!1,ae=function(){return O||(O=Ie(null).catch(function(e){return O=null,Promise.reject(e)}),O)};Promise.resolve().then(function(){return ae()}).catch(function(r){oe||console.warn(r)});var Me=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];oe=!0;var o=Date.now();return ae().then(function(a){return We(a,t,o)})};function z(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),t.push.apply(t,n)}return t}function H(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?z(Object(t),!0).forEach(function(n){se(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):z(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function T(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?T=function(e){return typeof e}:T=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(r)}function se(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function ie(r,e){return De(r)||qe(r,e)||Fe(r,e)||Ye()}function De(r){if(Array.isArray(r))return r}function qe(r,e){var t=r&&(typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"]);if(t!=null){var n=[],o=!0,a=!1,l,m;try{for(t=t.call(r);!(o=(l=t.next()).done)&&(n.push(l.value),!(e&&n.length===e));o=!0);}catch(s){a=!0,m=s}finally{try{!o&&t.return!=null&&t.return()}finally{if(a)throw m}}return n}}function Fe(r,e){if(r){if(typeof r=="string")return G(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return G(r,e)}}function G(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function Ye(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var y=function(e,t,n){var o=!!n,a=u.useRef(n);u.useEffect(function(){a.current=n},[n]),u.useEffect(function(){if(!o||!e)return function(){};var l=function(){a.current&&a.current.apply(a,arguments)};return e.on(t,l),function(){e.off(t,l)}},[o,t,e,a])},D=function(e){var t=u.useRef(e);return u.useEffect(function(){t.current=e},[e]),t.current},P=function(e){return e!==null&&T(e)==="object"},$e=function(e){return P(e)&&typeof e.then=="function"},Ke=function(e){return P(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},V="[object Object]",Je=function r(e,t){if(!P(e)||!P(t))return e===t;var n=Array.isArray(e),o=Array.isArray(t);if(n!==o)return!1;var a=Object.prototype.toString.call(e)===V,l=Object.prototype.toString.call(t)===V;if(a!==l)return!1;if(!a&&!n)return e===t;var m=Object.keys(e),s=Object.keys(t);if(m.length!==s.length)return!1;for(var C={},h=0;h<m.length;h+=1)C[m[h]]=!0;for(var S=0;S<s.length;S+=1)C[s[S]]=!0;var p=Object.keys(C);if(p.length!==m.length)return!1;var E=e,b=t,g=function(A){return r(E[A],b[A])};return p.every(g)},ue=function(e,t,n){return P(e)?Object.keys(e).reduce(function(o,a){var l=!P(t)||!Je(e[a],t[a]);return n.includes(a)?(l&&console.warn("Unsupported prop change: options.".concat(a," is not a mutable property.")),o):l?H(H({},o||{}),{},se({},a,e[a])):o},null):null},ce="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",Q=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ce;if(e===null||Ke(e))return e;throw new Error(t)},ze=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ce;if($e(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(o){return Q(o,t)})};var n=Q(e,t);return n===null?{tag:"empty"}:{tag:"sync",stripe:n}},He=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"2.8.1"}),e.registerAppInfo({name:"react-stripe-js",version:"2.8.1",url:"https://stripe.com/docs/stripe-js/react"}))},I=u.createContext(null);I.displayName="ElementsContext";var le=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},pe=function(e){var t=e.stripe,n=e.options,o=e.children,a=u.useMemo(function(){return ze(t)},[t]),l=u.useState(function(){return{stripe:a.tag==="sync"?a.stripe:null,elements:a.tag==="sync"?a.stripe.elements(n):null}}),m=ie(l,2),s=m[0],C=m[1];u.useEffect(function(){var p=!0,E=function(g){C(function(w){return w.stripe?w:{stripe:g,elements:g.elements(n)}})};return a.tag==="async"&&!s.stripe?a.stripePromise.then(function(b){b&&p&&E(b)}):a.tag==="sync"&&!s.stripe&&E(a.stripe),function(){p=!1}},[a,s,n]);var h=D(t);u.useEffect(function(){h!==null&&h!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[h,t]);var S=D(n);return u.useEffect(function(){if(s.elements){var p=ue(n,S,["clientSecret","fonts"]);p&&s.elements.update(p)}},[n,S,s.elements]),u.useEffect(function(){He(s.stripe)},[s.stripe]),u.createElement(I.Provider,{value:s},o)};pe.propTypes={stripe:c.any,options:c.object};var Ge=function(e){var t=u.useContext(I);return le(t,e)},Ve=function(){var e=Ge("calls useElements()"),t=e.elements;return t};c.func.isRequired;var de=u.createContext(null);de.displayName="CustomCheckoutSdkContext";var Qe=function(e,t){if(!e)throw new Error("Could not find CustomCheckoutProvider context; You need to wrap the part of your app that ".concat(t," in an <CustomCheckoutProvider> provider."));return e},Xe=u.createContext(null);Xe.displayName="CustomCheckoutContext";c.any,c.shape({clientSecret:c.string.isRequired,elementsOptions:c.object}).isRequired;var q=function(e){var t=u.useContext(de),n=u.useContext(I);if(t&&n)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CustomCheckoutProvider> and <Elements> providers."));return t?Qe(t,e):le(n,e)},Ze=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},d=function(e,t){var n="".concat(Ze(e),"Element"),o=function(s){var C=s.id,h=s.className,S=s.options,p=S===void 0?{}:S,E=s.onBlur,b=s.onFocus,g=s.onReady,w=s.onChange,A=s.onEscape,fe=s.onClick,me=s.onLoadError,ve=s.onLoaderStart,he=s.onNetworksChange,ye=s.onConfirm,ge=s.onCancel,Ce=s.onShippingAddressChange,Se=s.onShippingRateChange,N=q("mounts <".concat(n,">")),R="elements"in N?N.elements:null,L="customCheckoutSdk"in N?N.customCheckoutSdk:null,xe=u.useState(null),F=ie(xe,2),v=F[0],Ee=F[1],j=u.useRef(null),W=u.useRef(null);y(v,"blur",E),y(v,"focus",b),y(v,"escape",A),y(v,"click",fe),y(v,"loaderror",me),y(v,"loaderstart",ve),y(v,"networkschange",he),y(v,"confirm",ye),y(v,"cancel",ge),y(v,"shippingaddresschange",Ce),y(v,"shippingratechange",Se),y(v,"change",w);var M;g&&(e==="expressCheckout"?M=g:M=function(){g(v)}),y(v,"ready",M),u.useLayoutEffect(function(){if(j.current===null&&W.current!==null&&(R||L)){var x=null;L?x=L.createElement(e,p):R&&(x=R.create(e,p)),j.current=x,Ee(x),x&&x.mount(W.current)}},[R,L,p]);var Y=D(p);return u.useEffect(function(){if(j.current){var x=ue(p,Y,["paymentRequest"]);x&&"update"in j.current&&j.current.update(x)}},[p,Y]),u.useLayoutEffect(function(){return function(){if(j.current&&typeof j.current.destroy=="function")try{j.current.destroy(),j.current=null}catch{}}},[]),u.createElement("div",{id:C,className:h,ref:W})},a=function(s){q("mounts <".concat(n,">"));var C=s.id,h=s.className;return u.createElement("div",{id:C,className:h})},l=t?a:o;return l.propTypes={id:c.string,className:c.string,onChange:c.func,onBlur:c.func,onFocus:c.func,onReady:c.func,onEscape:c.func,onClick:c.func,onLoadError:c.func,onLoaderStart:c.func,onNetworksChange:c.func,onConfirm:c.func,onCancel:c.func,onShippingAddressChange:c.func,onShippingRateChange:c.func,options:c.object},l.displayName=n,l.__elementType=e,l},f=typeof window>"u",et=u.createContext(null);et.displayName="EmbeddedCheckoutProviderContext";var tt=function(){var e=q("calls useStripe()"),t=e.stripe;return t};d("auBankAccount",f);var X=d("card",f);d("cardNumber",f);d("cardExpiry",f);d("cardCvc",f);d("fpxBank",f);d("iban",f);d("idealBank",f);d("p24Bank",f);d("epsBank",f);d("payment",f);d("expressCheckout",f);d("currencySelector",f);d("paymentRequestButton",f);d("linkAuthentication",f);d("address",f);d("shippingAddress",f);d("paymentMethodMessaging",f);d("affirmMessage",f);d("afterpayClearpayMessage",f);const rt=()=>{const r=tt(),e=Ve(),[t,n]=B.useState(!1),[o,a]=B.useState(null),{toast:l}=we(),m=ee(),{user:s}=te(),{refreshPremiumStatus:C}=re(),h=async S=>{if(S.preventDefault(),!(!r||!e)){n(!0),a(null);try{if(!s)throw new Error("User not authenticated");const p=e.getElement(X);if(!p)throw new Error("Card element not found");const{error:E,paymentMethod:b}=await r.createPaymentMethod({type:"card",card:p});if(E)throw E;const{error:g}=await $.from("payment_history").insert([{user_id:s.id,amount:7.99,status:"completed",payment_method:"card",payment_method_id:b.id}]);if(g)throw console.error("Payment record error:",g),g;const{error:w}=await $.from("profiles").update({is_premium:!0}).eq("id",s.id);if(w)throw console.error("Premium status update error:",w),w;await C(),l({title:"Success!",description:"Your account has been upgraded to premium!"}),m("/diary")}catch(p){console.error("Upgrade error:",p),a(p.message),l({variant:"destructive",title:"Error",description:p.message||"Failed to process payment. Please try again."})}finally{n(!1)}}};return i.jsxs("form",{onSubmit:h,className:"space-y-6",children:[o&&i.jsx(Pe,{variant:"destructive",children:i.jsx(ke,{children:o})}),i.jsx("div",{className:"space-y-4",children:i.jsx("div",{className:"p-4 border rounded-md",children:i.jsx(X,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}},hidePostalCode:!0}})})}),i.jsxs(je,{type:"submit",className:"w-full",disabled:!r||t,children:[i.jsx(Ae,{className:"w-4 h-4 mr-2"}),t?"Processing...":"Pay £7.99/month"]})]})},nt="pk_test_51Qx8ZW2VssJgwMDKBMlrqlCvWJGssJw2DhQxKBYFetlue4dNUGESfKDVz9dOgThYSX1O4DvCWYAZIcQOWU8ebfF100JuLCHbao",ot=Me(nt),at={theme:"stripe",variables:{colorPrimary:"#22c55e",colorBackground:"#ffffff",colorText:"#30313d",colorDanger:"#df1b41",fontFamily:"Roboto, Open Sans, Segoe UI, sans-serif",spacingUnit:"4px",borderRadius:"4px"}},st=()=>i.jsx(pe,{stripe:ot,options:{appearance:at},children:i.jsx(rt,{})}),pt=()=>{const{user:r,loading:e}=te(),t=ee(),{isPremium:n}=re();return B.useEffect(()=>{!e&&n&&t("/diary")},[e,n,t]),B.useEffect(()=>{!e&&!r&&t("/auth?redirect=premium")},[e,r,t]),e?i.jsx(Ne,{}):r?i.jsx("div",{className:"min-h-screen bg-gradient-to-br from-white via-green-50 to-white py-12",children:i.jsx("div",{className:"container mx-auto px-4",children:i.jsxs(Oe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-md mx-auto bg-white rounded-2xl shadow-sm p-8",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[i.jsx(Z,{className:"w-6 h-6 text-yellow-500"}),i.jsx("h1",{className:"text-2xl font-semibold",children:"Upgrade to Premium"})]}),i.jsx(Re,{}),i.jsx(st,{})]})})}):null};export{pt as default};
